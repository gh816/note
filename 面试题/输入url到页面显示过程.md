# 输入url到页面显示过程

浏览器会先解析url，从中提取协议域名端口，路径和查询参数等信息。接着就是DNS解析，浏览器会先检查本地的DNS缓存，有的话直接使用缓存的IP地址，没有的话就向更高级别的DNS服务器查找。获取到ip地址之后就会建立TCP连接的三次握手，tcp连接成功后，浏览器会发送HTTP请求到服务器。其中请求方法，请求路径，请求头部和请求体等信息。服务器收到浏览器发送的请求后，会根据请求路径和请求方法来处理请求。服务器处理完请求后，会生成一个HTTP响应，该响应包含了响应状态码和响应头部等信息。浏览器会收到服务器的响应数据，其中包含HTML文件和其他资源。然后就是浏览器渲染过程了，浏览器会使用HTML解析器解析接收到的HTML内容，构建DOM树。同时，浏览器还会解析css样式表和执行js代码，来构建渲染树。浏览器会根据渲染树进行布局，确定每个元素的大小，位置和样式等信息，然后浏览器将渲染树的每个节点绘制到屏幕上，形成最终的页面展示。

## 何为三次握手

三次握手是客户端和服务端建立连接的过程。客户端向服务端发送连接时，首先会发一包连接请求数据，过去询问一下能否与你建立连接，这包数据叫SYN包，如果服务端同意连接则回复一包SYN+ACK包，客户端收到之后回复一包ACK包。这时候连接建立。因为这个过程中相互发送了三包数据所以称之为三次握手。

## 为什么是三次握手而不是两次握手

这是为了防止因为已失效的请求报文突然又传到服务器引起错误。这是什么意思？假设采用两次握手建立连接，客户端想服务端发送一个SYN包请求建立连接，这时候因为某些未知因素并没有到达服务器，为了建立连接客户端会重新发SYN包，这次包正常送达，服务端发送SYN+ACK包建立连接。但是第一个SYN包突然又送达到服务端，这时候服务端会误认为客户端又发起一个新的连接，从而两次握手后进入等待数据状态。服务端认为是两个连接，而客户端认为是一个连接，造成状态不一致。如果在三次握手的情况下，服务端收不到最后的ACK包，自然不会认为建立成功。**所以三次握手本质上就是为了解决网络信道不可靠的问题。**

## 四次挥手

四次挥手是客户端和服务端关闭连接的过程。客户端主动发起连接关闭请求，需要向服务端发起一包FIN包，表示要关闭连接，自己进入终止等待1状态，这是第一次挥手。服务端收到FIN包，发送一包ACK包，表示自己进入关闭等待状态，客户端进入终止等待2状态，这是第二次挥手。这时候服务端还可以发送未发送完的数据，而客户端还可以接收数据，待服务端发送完数据之后，发送一包FIN包，进入最后确认状态 ，这是第三次挥手。客户端收到之后回复ACK包进入超时等待状态，经过超时时间后关闭连接，而服务端收到ACK包立即关闭连接这是第四次挥手。为什么客户端需要等待超时间，这是为了保证服务端已经收到ACK包，因为假设客户端发送完玩ACK包就释放了连接，一旦ACK包在网络中丢失，服务端将一直停留在最后确认状态。如果客户端发送最后一包ACK包后，等待一段时间，这时服务端因为没有收到ACK包会重发FIN包，客户端会响应这个FIN包，重发ACK包并刷新超时时间。四次挥手是为了保证在不可靠的网络链路中进行可靠的连接断开确认。

